# loghouse

Веб-интерфейс просмотра логов для  
https://github.com/qw1mb0/kubernetes-fcht

## Возможности

### Язык запросов

Запрос (`QUERY`) имеет вид `EXPRESSION [QUERY_OPERATOR QUERY]`.

`QUERY_OPERATOR` может быть `AND` или `OR`.

Выражение (`EXPRESSION`) имеет вид `KEY EXPRESSION_OPERATOR VALUE`.

Ключом может быть любая строка, начинающаяся с символа и содержащая `[a-zA-Z0-9_\-\.]`, либо предопределённое значение `_any`, обозначающее любой ключ.

Есть несколько видов `EXPRESSION_OPERATOR`:
1. Равенство: `=`, `!=`. Применяется для строковых (`string_fields`) и численных (`number_fields`) значений. При этом если `VALUE` взято в кавычки, то поиск будет только среди строковых значений. Если `VALUE` имеет символы `%` или `_` — сравнение происходит с помощью `LIKE`.
2. Сравнение: `>`, `<`, `>=`, `<=`. Применяется толко для численных значений.
3. Регулярка: `=~`. Применяется только для строковых значений, поиск происходит с помощью `MATCH`.
4. Поиск булевых значений: `is true`, `is false`. Применяется только для булевых (`boolean_fields`) значений.
5. Поиск NULL значений: `is null`, `is not null`. Проверяется наличие ключа среди NULL-полей (`null_fields`.)

P.S. Все встроенные операторы (`_any`, `is null` и т.д.) являются регистронезависимыми. Операторы могут быть окружены пробелами.

#### Примеры
1.  `namespace=production AND log.level > 10`
1.  `_any =~ kube-[1-9]`
1.  `log = %error% or log != %success%`
1.  `unhealthy is true`
1.  `status is null`

### Выбор периода

Выбор периода может быть конкретным (с даты по дату) или от текущего момента. В этом случае используется вид "c `now` по `now-12h` (последние 12 часов). Поддерживаются следующие виды:
1.  `m` — минуты.
1.  `h` — часы.
1.  `d` — дни.
1.  `w` — недели.
1.  `M` — месяцы.
1.  `y` — годы.

Для удобства есть быстрые кнопки (`Last 5 minutes`, `Last 12 hours`, `Last 7 days` и т.д.).

Если явно не выбрано значение периода — по умолчанию берётся `Last 12 hours`.

### Бесконечная прокрутка

Изначально на странице выводятся последние 50 записей, от старых (сверху) к новым (снизу), и автоматически проматывается вниз к самым новым. При скролле вверх подгружаются всё более и более старые записи (тоже по 50 штук).

### Режим follow

Если включить режим follow, то каждые 5 секунд будет происходить запрос на наличие новых данных под текущему запросу. Они будут подставляться снизу. Чтобы отделить уже просмотренные записи от новых, можно добавить Breakpoint, нажав на соответствующую кнопку. В этом случае в самый низ логов подставится строка вида `--- Breakpoint at 2017-10-10 12:27:36 ---`, а все новые записи будут появляться под ней.

### Сохранение запросов

Каждый запрос можно сохранить (либо просто добавить новый на странице `Manage queries`) для последующего быстрого доступа к нему. Все сохранённые запросы видны на странице `Manage queries`, там же их можно сортировать (через перетаскивание), чтобы определить порядок, выводимый в всплывающем окне на главной странице по нажатию кнопки `Load queries`. Там выводятся только первые 10 запросов, а при нажатии на один из них он тут же выполняется.
